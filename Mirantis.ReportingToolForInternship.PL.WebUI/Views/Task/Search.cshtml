@using Mirantis.ReportingTool.PL.WebUI.Models.Repositories
@using Mirantis.ReportingTool.PL.WebUI.Constants
@model Mirantis.ReportingTool.PL.WebUI.Models.SearchTaskVM

@{
	ViewBag.Title = "Search tasks";
	AjaxOptions ajaxOpts = new AjaxOptions
	{
		UpdateTargetId = "OutputTasks",
		Url = Url.Action("ShowSearchResult"),
		OnSuccess = "slideDownOutputTasks",
		OnBegin = "beginSearch",
		OnComplete = "completeSearch",
		OnFailure = "alertAboutFail",
	};
}

<h2>Search tasks</h2>

@using (Ajax.BeginForm(ajaxOpts))
{

	@Html.AntiForgeryToken()

	<div class="form-horizontal">
		<hr />

		@Html.ValidationSummary(true, "", new { @class = "text-danger" })
		<div class="row">
			<div class="col-xs-12 col-md-6">
				@Html.LabelFor(model => model.AssigneeId, htmlAttributes: new { @class = "control-label col-xs-4" })
				<div class="col-xs-8">
					<select name="AssigneeId" id="AssigneeId" class="selectpicker" data-live-search="true" data-size="5">
						<option value="">All</option>
						@foreach (var item in UserLogicProvider.UserLogic.GetUsersByRole(AppRoles.Engineer))
						{
							<option value="@item.Id">
								@string.Format("{0} - {1}", item.FullName, item.Login)
							</option>
						}
					</select>
					@Html.ValidationMessageFor(model => model.AssigneeId, "", new { @class = "text-danger" })
				</div>
			</div>

			<div class="col-xs-12 col-md-6">
				@Html.LabelFor(model => model.ReporterId, htmlAttributes: new { @class = "control-label col-xs-4" })
				<div class="col-xs-8">
					<select name="ReporterId" id="ReporterId" class="selectpicker" data-live-search="true" data-size="5">
						<option value="">All</option>
						@foreach (var item in UserLogicProvider.UserLogic.GetAll())
						{
							<option value="@item.Id">
								@string.Format("{0} - {1}", item.FullName, item.Login)
							</option>
						}
					</select>
					@Html.ValidationMessageFor(model => model.ReporterId, "", new { @class = "text-danger" })
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-xs-12 col-md-6">
				@Html.LabelFor(model => model.ProjectId, htmlAttributes: new { @class = "control-label col-xs-4" })
				<div class="col-xs-8">
					<select name="ProjectId" id="ProjectId" class="selectpicker" data-live-search="true" data-size="5">
						@foreach (var item in ProjectLogicProvider.ProjectLogic.GetAll())
						{
							<option value="@item.Id">
								@string.Format("{0} - {1}", item.Name, item.Customer)
							</option>
						}
					</select>
					@Html.ValidationMessageFor(model => model.ProjectId, "", new { @class = "text-danger" })
				</div>
			</div>

			<div class="col-xs-12 col-md-6">
				@Html.LabelFor(model => model.Status, htmlAttributes: new { @class = "control-label col-xs-4" })
				<div class="col-xs-8">
					<select name="Status" id="Status" class="selectpicker" data-live-search="true" data-size="5">
						@foreach (var item in StatusRepo.AllTypes)
						{
							<option value="@item">@item</option>
						}
					</select>
					@Html.ValidationMessageFor(model => model.Status, "", new { @class = "text-danger" })
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-xs-12 col-md-6">
				@Html.LabelFor(model => model.Title, htmlAttributes: new { @class = "control-label col-xs-4" })
				<div class="col-xs-8">
					@Html.EditorFor(model => model.Title, new { htmlAttributes = new { @class = "form-control" } })
					@Html.ValidationMessageFor(model => model.Title, "", new { @class = "text-danger" })
				</div>
			</div>
		</div>

		<div class="row">
			<div class="text-center">
				<input type="submit" value="Search" class="btn btn-default" />
			</div>
		</div>
	</div>

	<div id="LoadingStatus" class="text-center">
		<img src="~/Images/loading.gif" />
	</div>

	<div id="OutputTasks">
	</div>
}

@section scripts {
	<script src="~/Scripts/bootstrap-select.min.js"></script>
	<script src="~/Scripts/jquery.validate.js"></script>
	<script src="~/Scripts/jquery.validate.unobtrusive.js"></script>
	<script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>

	<script src="~/Scripts/Custom/changeStatusLoadingIcon.js"></script>
	<script src="~/Scripts/Custom/actionsAfterFail.js"></script>
	<script src="~/Scripts/Custom/disableInputs.js"></script>
	<script src="~/Scripts/Custom/descriptionFunctionsOnSearchsEvents.js"></script>
	<script>
		function slideDownOutputTasks() {
			$("#OutputTasks")
				.hide()
				.slideDown(300);
		}
	</script>
}